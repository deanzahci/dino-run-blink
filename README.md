# Dino Run Blink

A Python project to play the classic offline dinosaur game using eye blinks detected by a MUSE 2 Brain-Computer Interface (BCI). The script processes EOG signals in real-time, calculates their RMS value, and simulates a spacebar press upon detecting a blink.

https://github.com/user-attachments/assets/89b8f244-222a-4ff5-aeae-40e1bc9b25e1

## How It Works

This system captures electrooculography (EOG) signals, which are generated by the muscle movements around the eyes during a blink.

1.  **Data Acquisition**: Data is captured from the **AF7** (channel 1) and **AF8** (channel 2) sensors on the MUSE 2 headset at a sampling rate of **256 Hz** (refer to `SAMPLE_RATE` in `config.py`).
2.  **Real-time Streaming**: The data is streamed from the MUSE 2 to a PC via Bluetooth using the **Petalmetrics** software. The script connects to the LSL stream named `"PetalStream_eeg"`.
3.  **Signal Processing**: - The Python script receives the LSL data stream and collects it into a buffer of the determined size (refer to `BUFFER_SIZE` in `config.py`). - A **Butterworth bandpass filter** (0.5 Hz to 10.0 Hz) is applied to the data from each channel to remove noise. - The **Root Mean Square (RMS)** is calculated for each channel (AF7, AF8) within the buffer.

```math
\text{combined\_data} = \frac{\text{af7\_data} + \text{af8\_data}}{2}, \quad \text{rms} = \sqrt{ \frac{1}{n} \sum_{i=1}^{n} \text{combined\_data}_i^2 }
```

4.  **Blink Detection**: If this combined RMS value exceeds a predefined `BLINK_THRESHOLD`, it is registered as a blink.
5.  **Game Control**: Upon detecting a blink, the script simulates a **spacebar press** using `pynput`, causing the dinosaur in the game to jump.

## Requirements

### Hardware

- MUSE 2 Headset (or compatible EEG device)
- A PC with Bluetooth
- Petalmetrics Application

### Software

- Python 3.11 (pylsl library might not support versions above 3.11)
- Check [pyproject.toml](pyproject.toml) or [requirements.txt](requirements.txt) for the full list of dependencies.

## Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/your-repo/dino-run-blink.git
   cd dino-run-blink
   ```

2. Install dependencies using `uv` (recommended) or `pip`:

   ```bash
   uv sync  # Installs dependencies from pyproject.toml
   # or
   pip install -r requirements.txt
   ```

3. Ensure Python 3.11+ is used (check with `python --version`).

## Usage

1. **Prerequisites**: Set up the MUSE 2 headset and start streaming EEG data via Petalmetrics software to the LSL stream `"PetalStream_eeg"`. Open the Chrome dinosaur game in offline mode.

2. **Run the script**:

   ```bash
   python src/main.py
   ```

3. **Follow prompts**:
   - Choose calibration mode (1 for calibrate, 0 for no calibrate).
   - Choose action mode (1 to enable keyboard simulation, 0 for no action).

4. The script will display a real-time plot of RMS values and detect blinks to simulate spacebar presses for jumping.

## Configuration

Key parameters are defined in `src/config.py`. Adjust as needed:

- `BLINK_THRESHOLD_INIT`: Initial RMS threshold for blink detection (default: 400).
- `FS`: Sampling frequency (fixed at 256 Hz for MUSE 2).
- `RMS_BUFFER_SIZE`: Number of samples for RMS calculation (default: 16).
- `BANDPASS_LOW_CUT` / `BANDPASS_HIGH_CUT`: Filter frequencies (0.5-10 Hz).
- `SLIDING_WINDOW_SIZE` / `SLIDING_WINDOW_THRESHOLD`: Voting parameters for blink detection.

Run `python -c "from src.config import verify_config_parameters; verify_config_parameters()"` to validate settings.

## Testing

Run the test suite to verify functionality:

```bash
uv run python tests/test_config_and_utils.py
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
